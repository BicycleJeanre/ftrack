<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Tests - FTrack</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        .test-section {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }
        #console {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .passed {
            color: #4ec9b0;
        }
        .failed {
            color: #f48771;
        }
        .info {
            color: #d4d4d4;
        }
        button {
            background: #4ec9b0;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            margin: 10px 5px;
        }
        button:hover {
            background: #5dd9c0;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .results-summary {
            background: #2d2d30;
            border: 2px solid #4ec9b0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        .results-summary.show {
            display: block;
        }
        .stat {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat.passed {
            color: #4ec9b0;
        }
        .stat.failed {
            color: #f48771;
        }
    </style>
</head>
<body>
    <h1>üß™ FTrack Integration Tests</h1>
    
    <div class="test-section">
        <h2 style="margin-top: 0; color: #4ec9b0;">Test Suite</h2>
        <p>Comprehensive automated testing of all refactored features and data operations.</p>
        
        <div style="margin: 20px 0;">
            <button id="run-tests-btn">‚ñ∂Ô∏è Run All Tests</button>
            <button id="clear-console-btn">üóëÔ∏è Clear Console</button>
        </div>

        <div class="results-summary" id="results-summary">
            <h3 style="margin-top: 0; color: #4ec9b0;">Test Results</h3>
            <div class="stat passed" id="passed-count">‚úÖ Passed: 0</div>
            <div class="stat failed" id="failed-count">‚ùå Failed: 0</div>
            <div class="stat info" id="total-count">üìä Total: 0</div>
            <div class="stat info" id="success-rate">üéØ Success Rate: 0%</div>
        </div>
    </div>

    <div class="test-section">
        <h2 style="margin-top: 0; color: #4ec9b0;">Test Console</h2>
        <div id="console">Ready to run tests...</div>
    </div>

    <script type="module">
        import IntegrationTests from '../js/integration-tests.js';

        const consoleDiv = document.getElementById('console');
        const runTestsBtn = document.getElementById('run-tests-btn');
        const clearConsoleBtn = document.getElementById('clear-console-btn');
        const resultsSummary = document.getElementById('results-summary');
        const passedCount = document.getElementById('passed-count');
        const failedCount = document.getElementById('failed-count');
        const totalCount = document.getElementById('total-count');
        const successRate = document.getElementById('success-rate');

        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            const text = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            let className = 'info';
            if (text.includes('PASSED') || text.includes('‚úÖ')) {
                className = 'passed';
            } else if (text.includes('FAILED') || text.includes('‚ùå')) {
                className = 'failed';
            }
            
            const line = document.createElement('div');
            line.className = className;
            line.textContent = text;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            const text = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const line = document.createElement('div');
            line.className = 'failed';
            line.textContent = text;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            originalError.apply(console, args);
        };

        runTestsBtn.addEventListener('click', async () => {
            runTestsBtn.disabled = true;
            runTestsBtn.textContent = '‚è≥ Running Tests...';
            consoleDiv.innerHTML = '';
            resultsSummary.classList.remove('show');

            try {
                const testSuite = new IntegrationTests();
                const results = await testSuite.runAll();

                // Update results summary
                passedCount.textContent = `‚úÖ Passed: ${results.passed}`;
                failedCount.textContent = `‚ùå Failed: ${results.failed}`;
                totalCount.textContent = `üìä Total: ${results.passed + results.failed}`;
                const rate = ((results.passed / (results.passed + results.failed)) * 100).toFixed(1);
                successRate.textContent = `üéØ Success Rate: ${rate}%`;
                resultsSummary.classList.add('show');

            } catch (error) {
                console.error('Test suite error:', error);
            } finally {
                runTestsBtn.disabled = false;
                runTestsBtn.textContent = '‚ñ∂Ô∏è Run All Tests';
            }
        });

        clearConsoleBtn.addEventListener('click', () => {
            consoleDiv.innerHTML = 'Console cleared. Ready to run tests...';
            resultsSummary.classList.remove('show');
        });

        console.log('Test suite loaded. Click "Run All Tests" to begin.');
    </script>
</body>
</html>
